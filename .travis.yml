# The following enables several GHC versions to be tested; often it's enough to
# test only against the last release in a major GHC version. Feel free to omit
# lines listings versions you don't need/want testing for.
language: c
env:
 - GHCVER=7.6.3
 - GHCVER=7.8.4
 - GHCVER=7.10.3
 - GHCVER=8.0.1
 - GTKVER=2
 - GTKVER=3

# Note: the distinction between `before_install` and `install` is not important.
before_install:
 - cd gtk$GTKVER/
 - unset CC

install:
 - travis_retry sudo add-apt-repository -y ppa:hvr/ghc
 - travis_retry sudo apt-get update
 - travis_retry sudo apt-get install libgtk2.0-dev libglib2.0-dev
 - travis_retry sudo apt-get install cabal-install-1.24 ghc-$GHCVER-prof ghc-$GHCVER-dyn alex-3.1.4 happy-1.19.5
 - export PATH=$HOME/.cabal/bin:/opt/ghc/$GHCVER/bin:/opt/cabal/1.24/bin:/opt/alex/3.1.4/bin:/opt/happy/1.19.5/bin:$PATH
 - travis_retry cabal update

script:
 - travis_retry cabal install --run-tests -v -j1

notifications:
 email: true

branches:
    only:
          - master
          - develop

# This step requires the use of edge: true in deploy. For details, see
# https://docs.travis-ci.com/user/deployment-v2
before_deploy:
  - cd gtk$GTKVER

deploy:
  edge:     true
  provider: hackage
  username: keera_studios_ci
  password:
    secure: qRdGcL5+9Icow880LbaTNQMq4UyqNsI98HZHtuKfiZCsXwIeEW9jsTiUZC0EuE2ZKLWscHdfqd531A+wWXiHxC2sAJ8woVNLcOu+URphBzpAkvJMAYCZGhAQhzm3xllyVcg2USDr2vVgn02mTDcZmmiK6ztDHqibxC+D54eDIkNpCEiLaR24zp7ErlzyoVDOkFSfN4tWAAUCgTunjg17Hn/UxEBdPjcpCg9UXrl/BzdWbqPYkxh1OI3Gl+3yvQh07f3ub6PhiCSQWYIO6q94b2F2h+FBLRq8vupgg5wd+wF8tmiCYsJx8k3UCi9v2Oh6XTb+xtO0nL/c3+vrV+Dcw5hBSDjSZ5TpSE8U7jDajkWRZhpLUlrUyMbLQhJH9QY+asxVlmr6sSnf3D//AQKYFptm+ovmdlWE3jxJ99PRSVW6efaLvedvf2VOL7ZtwBYZOd1QGXkBDAsDEv/LxPql4BeLYHTgVVO9bjYOpvSM9oC2gNCDQzOJlb8HUfSG721HIngZmAE7BpjTQhCatYdauW236brddXQEpSEQxfEJbcsoZWrO2kD7GO9EzVfaV1OrOgJf2IBZTLEXlEMpUzG26lrCs+cb0NpReRyZWZMEH04uX/yhHVlA3pSiQLB2u0fsmmRjvwzstTnvzEN9HpPksw36mgUKgzF+y4KMKDcL7d4=
  on:
    branch: master
    condition: "$GHCVER = 8.0.1"
